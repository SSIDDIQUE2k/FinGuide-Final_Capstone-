{% extends "financial/base.html" %}

{% block title %}Financial Calculator - Financial Tools{% endblock %}

{% block content %}
<h1>ðŸ§® Financial Calculator</h1>
<p style="color: #666; margin-bottom: 20px;">Calculate compound interest, loan payments, and investment growth with ease.</p>

<div style="margin-bottom: 40px;">
    <h2>Compound Interest Calculator</h2>
    <div class="grid-2">
        <div>
            <div class="input-group">
                <label for="principal">Principal Amount ($)</label>
                <input type="number" id="principal" placeholder="e.g., 5000" min="0" step="0.01" />
            </div>
            <div class="input-group">
                <label for="rate">Annual Interest Rate (%)</label>
                <input type="number" id="rate" placeholder="e.g., 5" min="0" step="0.01" />
            </div>
            <div class="input-group">
                <label for="time">Time (Years)</label>
                <input type="number" id="time" placeholder="e.g., 10" min="0" step="0.1" />
            </div>
            <div class="input-group">
                <label for="frequency">Compounding Frequency</label>
                <select id="frequency">
                    <option value="1">Annually</option>
                    <option value="2">Semi-annually</option>
                    <option value="4">Quarterly</option>
                    <option value="12" selected>Monthly</option>
                    <option value="365">Daily</option>
                </select>
            </div>
            <button onclick="calculateCompoundInterest()">Calculate</button>
        </div>
        <div>
            <div class="result" id="compoundResult">
                <h3>Compound Interest Results</h3>
                <div class="result-item">
                    <span class="result-label">Principal</span>
                    <span class="result-value">$<span id="compPrincipal">0.00</span></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Interest Rate</span>
                    <span class="result-value"><span id="compRate">0</span>%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Time Period</span>
                    <span class="result-value"><span id="compTime">0</span> years</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Interest Earned</span>
                    <span class="result-value" style="color: #22c55e;">$<span id="interestEarned">0.00</span></span>
                </div>
                <div class="result-item" style="background: #e8f5e9; padding: 10px; border-radius: 4px;">
                    <span class="result-label" style="font-weight: 700;">Final Amount</span>
                    <span class="result-value" style="color: #22c55e; font-size: 18px;">$<span id="finalAmount">0.00</span></span>
                </div>
            </div>
            <div id="compoundError" class="error" style="display: none;"></div>
        </div>
    </div>
</div>

<hr style="margin: 40px 0; border: none; border-top: 2px solid #ddd;">

<div style="margin-bottom: 40px;">
    <h2>Loan Payment Calculator</h2>
    <div class="grid-2">
        <div>
            <div class="input-group">
                <label for="loanPrincipal">Loan Amount ($)</label>
                <input type="number" id="loanPrincipal" placeholder="e.g., 200000" min="0" step="0.01" />
            </div>
            <div class="input-group">
                <label for="loanRate">Annual Interest Rate (%)</label>
                <input type="number" id="loanRate" placeholder="e.g., 5.5" min="0" step="0.01" />
            </div>
            <div class="input-group">
                <label for="loanMonths">Loan Term (Months)</label>
                <input type="number" id="loanMonths" placeholder="e.g., 360" min="1" step="1" />
            </div>
            <button onclick="calculateLoan()">Calculate Payment</button>
        </div>
        <div>
            <div class="result" id="loanResult">
                <h3>Monthly Payment Breakdown</h3>
                <div class="result-item">
                    <span class="result-label">Loan Amount</span>
                    <span class="result-value">$<span id="loanAmount">0.00</span></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Interest Rate</span>
                    <span class="result-value"><span id="loanRateDisplay">0</span>%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Loan Term</span>
                    <span class="result-value"><span id="loanTermDisplay">0</span> months</span>
                </div>
                <div class="result-item" style="background: #fff0f5; padding: 10px; border-radius: 4px;">
                    <span class="result-label" style="font-weight: 700;">Monthly Payment</span>
                    <span class="result-value" style="color: #d946a6; font-size: 18px;">$<span id="monthlyPayment">0.00</span></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Payment</span>
                    <span class="result-value">$<span id="totalPayment">0.00</span></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Interest</span>
                    <span class="result-value" style="color: #ef4444;">$<span id="totalInterest">0.00</span></span>
                </div>
            </div>
            <div id="loanError" class="error" style="display: none;"></div>
        </div>
    </div>
</div>

<hr style="margin: 40px 0; border: none; border-top: 2px solid #ddd;">

<div style="margin-bottom: 40px;">
    <h2>Investment Growth Calculator</h2>
    <div class="grid-2">
        <div>
            <div class="input-group">
                <label for="investInitial">Initial Investment ($)</label>
                <input type="number" id="investInitial" placeholder="e.g., 10000" min="0" step="0.01" />
            </div>
            <div class="input-group">
                <label for="investMonthly">Monthly Contribution ($)</label>
                <input type="number" id="investMonthly" placeholder="e.g., 500" min="0" step="0.01" />
            </div>
            <div class="input-group">
                <label for="investReturn">Annual Return (%)</label>
                <input type="number" id="investReturn" placeholder="e.g., 8" min="0" step="0.01" />
            </div>
            <div class="input-group">
                <label for="investYears">Investment Period (Years)</label>
                <input type="number" id="investYears" placeholder="e.g., 30" min="1" step="1" />
            </div>
            <button onclick="calculateInvestment()">Calculate Growth</button>
        </div>
        <div>
            <div class="result" id="investmentResult">
                <h3>Investment Growth Projection</h3>
                <div class="result-item">
                    <span class="result-label">Initial Investment</span>
                    <span class="result-value">$<span id="investmentInitial">0.00</span></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Monthly Contribution</span>
                    <span class="result-value">$<span id="investmentMonthly">0.00</span></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Annual Return</span>
                    <span class="result-value"><span id="investmentReturn">0</span>%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Time Period</span>
                    <span class="result-value"><span id="investmentYears">0</span> years</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Invested</span>
                    <span class="result-value">$<span id="totalInvested">0.00</span></span>
                </div>
                <div class="result-item" style="background: #e8f5e9; padding: 10px; border-radius: 4px;">
                    <span class="result-label" style="font-weight: 700;">Total Value</span>
                    <span class="result-value" style="color: #22c55e; font-size: 18px;">$<span id="totalValue">0.00</span></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Investment Gain</span>
                    <span class="result-value" style="color: #22c55e;">$<span id="totalGain">0.00</span></span>
                </div>
            </div>
            <div id="investmentError" class="error" style="display: none;"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function calculateCompoundInterest() {
        const principal = parseFloat(document.getElementById('principal').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const time = parseFloat(document.getElementById('time').value);
        const frequency = parseInt(document.getElementById('frequency').value);
        const errorDiv = document.getElementById('compoundError');

        if (!principal || principal <= 0 || !rate || rate < 0 || !time || time <= 0) {
            errorDiv.textContent = 'Please enter valid values for all fields';
            errorDiv.style.display = 'block';
            return;
        }

        fetch('/api/calculate-compound-interest/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),
            },
            body: JSON.stringify({ principal, rate, time, frequency })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                errorDiv.textContent = 'Error: ' + data.error;
                errorDiv.style.display = 'block';
            } else {
                errorDiv.style.display = 'none';
                document.getElementById('compPrincipal').textContent = data.principal.toFixed(2);
                document.getElementById('compRate').textContent = data.rate;
                document.getElementById('compTime').textContent = data.time;
                document.getElementById('interestEarned').textContent = data.interest_earned.toFixed(2);
                document.getElementById('finalAmount').textContent = data.final_amount.toFixed(2);
                document.getElementById('compoundResult').classList.add('show');
            }
        })
        .catch(error => {
            errorDiv.textContent = 'Error: ' + error.message;
            errorDiv.style.display = 'block';
        });
    }

    function calculateLoan() {
        const principal = parseFloat(document.getElementById('loanPrincipal').value);
        const rate = parseFloat(document.getElementById('loanRate').value);
        const months = parseInt(document.getElementById('loanMonths').value);
        const errorDiv = document.getElementById('loanError');

        if (!principal || principal <= 0 || !rate || rate < 0 || !months || months <= 0) {
            errorDiv.textContent = 'Please enter valid values for all fields';
            errorDiv.style.display = 'block';
            return;
        }

        fetch('/api/calculate-loan/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),
            },
            body: JSON.stringify({ principal, annual_rate: rate, months })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                errorDiv.textContent = 'Error: ' + data.error;
                errorDiv.style.display = 'block';
            } else {
                errorDiv.style.display = 'none';
                document.getElementById('loanAmount').textContent = data.principal.toFixed(2);
                document.getElementById('loanRateDisplay').textContent = data.annual_rate;
                document.getElementById('loanTermDisplay').textContent = data.months;
                document.getElementById('monthlyPayment').textContent = data.monthly_payment.toFixed(2);
                document.getElementById('totalPayment').textContent = data.total_payment.toFixed(2);
                document.getElementById('totalInterest').textContent = data.total_interest.toFixed(2);
                document.getElementById('loanResult').classList.add('show');
            }
        })
        .catch(error => {
            errorDiv.textContent = 'Error: ' + error.message;
            errorDiv.style.display = 'block';
        });
    }

    function calculateInvestment() {
        const initial = parseFloat(document.getElementById('investInitial').value);
        const monthly = parseFloat(document.getElementById('investMonthly').value);
        const returnRate = parseFloat(document.getElementById('investReturn').value);
        const years = parseInt(document.getElementById('investYears').value);
        const errorDiv = document.getElementById('investmentError');

        if ((initial === undefined || initial < 0) || (monthly === undefined || monthly < 0) || !returnRate || returnRate < 0 || !years || years <= 0) {
            errorDiv.textContent = 'Please enter valid values for all fields';
            errorDiv.style.display = 'block';
            return;
        }

        fetch('/api/calculate-investment-growth/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),
            },
            body: JSON.stringify({ initial, monthly_contribution: monthly, annual_return: returnRate, years })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                errorDiv.textContent = 'Error: ' + data.error;
                errorDiv.style.display = 'block';
            } else {
                errorDiv.style.display = 'none';
                document.getElementById('investmentInitial').textContent = data.initial.toFixed(2);
                document.getElementById('investmentMonthly').textContent = data.monthly_contribution.toFixed(2);
                document.getElementById('investmentReturn').textContent = data.annual_return;
                document.getElementById('investmentYears').textContent = data.years;
                document.getElementById('totalInvested').textContent = data.total_invested.toFixed(2);
                document.getElementById('totalValue').textContent = data.total_value.toFixed(2);
                document.getElementById('totalGain').textContent = data.total_gain.toFixed(2);
                document.getElementById('investmentResult').classList.add('show');
            }
        })
        .catch(error => {
            errorDiv.textContent = 'Error: ' + error.message;
            errorDiv.style.display = 'block';
        });
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
{% endblock %}
