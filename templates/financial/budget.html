{% extends 'financial/base.html' %}

{% block title %}Budget Calculator - FinanceAI{% endblock %}

{% block content %}
<h1>ğŸ“Š Budget Calculator</h1>
<p>Use the 50/30/20 budgeting rule to allocate your monthly income wisely. 50% for needs, 30% for wants, and 20% for savings.</p>

<div class="grid-2">
    <div>
        <h2 style="margin-top: 0;">Enter Your Income</h2>
        <div class="input-group">
            <label for="income">Monthly Gross Income ($)</label>
            <input type="number" id="income" placeholder="e.g., 5000" step="0.01" min="0">
        </div>
        <div class="input-group">
            <label for="needsPercent">Needs (%)</label>
            <input type="number" id="needsPercent" value="50" step="0.1" min="0" max="100">
        </div>
        <div class="input-group">
            <label for="wantsPercent">Wants (%)</label>
            <input type="number" id="wantsPercent" value="30" step="0.1" min="0" max="100">
        </div>
        <div class="input-group">
            <label for="savingsPercent">Savings (%)</label>
            <input type="number" id="savingsPercent" value="20" step="0.1" min="0" max="100">
        </div>
        <button onclick="calculateBudget()" style="width: 100%;">Calculate Budget</button>
    </div>

    <div>
        <div class="result" id="result">
            <h3 style="margin-top: 0;">Budget Breakdown</h3>
            <div class="result-item">
                <span class="result-label">ğŸ’° Needs (Essential)</span>
                <span class="result-value" id="needsAmount">$0.00</span>
            </div>
            <div class="result-item">
                <span class="result-label">ğŸ¯ Wants (Lifestyle)</span>
                <span class="result-value" id="wantsAmount">$0.00</span>
            </div>
            <div class="result-item">
                <span class="result-label">ğŸ¦ Savings (Future)</span>
                <span class="result-value" id="savingsAmount">$0.00</span>
            </div>
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                <div class="result-item">
                    <span class="result-label" style="font-weight: 700;">Total</span>
                    <span class="result-value" style="font-weight: 700;" id="totalAmount">$0.00</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div style="background: linear-gradient(135deg, #f0f9ff 0%, #fef3c7 100%); padding: 1.5rem; border-radius: 0.75rem; border: 1px solid #e5e7eb; margin-top: 2rem;">
    <h2 style="margin-top: 0;">ğŸ“š Budget Tips</h2>
    <ul style="margin-left: 1.5rem; color: #6b7280; line-height: 1.8;">
        <li><strong>Needs</strong>: Housing, utilities, groceries, insurance, transportation</li>
        <li><strong>Wants</strong>: Entertainment, dining out, hobbies, shopping</li>
        <li><strong>Savings</strong>: Emergency fund, investments, debt repayment, retirement</li>
        <li>Adjust percentages based on your lifestyle and financial goals</li>
        <li>Track your spending to ensure you stay within your budget</li>
    </ul>
</div>

<script>
async function calculateBudget() {
    const income = parseFloat(document.getElementById('income').value) || 0;
    const needsPercent = parseFloat(document.getElementById('needsPercent').value) || 50;
    const wantsPercent = parseFloat(document.getElementById('wantsPercent').value) || 30;
    const savingsPercent = parseFloat(document.getElementById('savingsPercent').value) || 20;
    
    if (income <= 0) {
        alert('Please enter a valid income');
        return;
    }
    
    const needsAmount = income * needsPercent / 100;
    const wantsAmount = income * wantsPercent / 100;
    const savingsAmount = income * savingsPercent / 100;
    
    document.getElementById('needsAmount').textContent = '$' + needsAmount.toFixed(2);
    document.getElementById('wantsAmount').textContent = '$' + wantsAmount.toFixed(2);
    document.getElementById('savingsAmount').textContent = '$' + savingsAmount.toFixed(2);
    document.getElementById('totalAmount').textContent = '$' + income.toFixed(2);
    
    document.getElementById('result').classList.add('show');
    
    // Send to backend for potential analytics
    try {
        await fetch('{% url "financial:calculate_budget" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
            },
            body: JSON.stringify({
                income: income,
                needs_percent: needsPercent,
                wants_percent: wantsPercent,
                savings_percent: savingsPercent
            })
        });
    } catch (error) {
        console.error('Analytics error:', error);
    }
}
</script>
{% endblock %}
